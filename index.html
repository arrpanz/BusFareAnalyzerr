<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" href="css/mystyle.css" />
  <meta charset="UTF-8" />
  <script src="./index.js"></script>
  <script src="./calculation.js"></script>
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bus Fare Analyzer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
  <style></style>
</head>

<body>
  <header>
    <nav>
      <div class="left"><img src="images/bfaLogo.png" width=80 height=80 px></div>
      <div class="right">
        <ul>
          <li><button onclick="index.html">Home</button></a> </li>
          <li>|</li>
          <li><button onclick="index.html">About Project</button></a> </li>
        </ul>
      </div>
    </nav>
  </header>

  <!--Main Content Starts  -->
  <div class="center-content">
    <div class="contact-form">
        <div class="form-heading">
            <h1>Calculate Bus Fare</h1>
        </div>

        <div class="internalText">
            <p><br>Please verify yourself to the staff before selecting: </p><br>
            <input type="radio" id="student" name="option" value="student">
            <label for="student"> Student(45%) </label><br>
    
            <input type="radio" id="SeniorCitizen" name="option" value="senior">
            <label for="SeniorCitizen"> Senior Citizen/Differentially Abled(50%) </label><br>
    
            <input type="radio" id="None" name="option" value="none">
            <label for="None"> None </label> <br><br>
            <form  class="form-horizontal">
                <div class="form-group">
                  <input class="main-btn" type="button" value="Current Location" onclick="getLocation()">

                    <label for="from" class="label">From :</label>
                    <div class="input">
                        <select id="from" class="form-input">
                            <option value = "27.693361,85.281843">Kalanki</option>
                            <option value = "Satdobato Bus Stop,Ring Rd, Kathmandu">Satdobato</option>
                            <option value = "Gwarko Bus Stand,Ring Rd,Kathmandu">Gwarko</option>
                            <option value = "Balkumari Bus Stand,Ring Rd,Kathmandu">Balkumari</option>
                            <option value = "Koteshwore Bus Stand,Ring Rd,Kathmandu">Koteswor</option>
                            <option value = "Tribhuvan International Airport Bus Stop,Ring Rd">Tribhuvan International Airport</option>
                            <option value = "Gaushala Bus Stop,Ring Rd,Kathmandu">Gaushala</option>
                            <option value = "Chabhil Bus Stop,Ring Rd,Kathmandu">Chabhil</option>
                            <option value = "Sukedhara Bus Stop,Ring Rd,Kathmandu">Sukedhara</option>
                            <option value = "Maharajganj Bus Stop,Ring Rd,Kathmandu">Maharajganj</option>
                            <option value = "Basundhara Bus Stop,Ring Rd,Kathmandu">Basundhara</option>
                            <option value = "Samakhushi Bus Stop,Ring Rd,Kathmandu">Samakhushi</option>
                            <option value = "Gongabu Bus Stop,Ring Rd,Kathmandu">Gongabu</option>
                            <option value = "Balaju Bus Stop,Ring Rd,Kathmandu">Balaju</option>
                            <option value = "Swayambhunath Bus Stop,Ring Rd,Kathmandu">Swayambhunath</option>
                            <option value = "Balkhu bus stop,Ring Rd,Kathmandu">Balkhu</option>
                        </select>
                    </div>
                </div> 

                <div class="form-group">
                    <label for="to" class="label" >To : </label>

                    <div class="input">
                        <select id="to" class="form-input">
                            <option value = "Satdobato Bus Stop,Ring Rd, Kathmandu">Satdobato</option>
                            <option value = "Kalanki Bus Stop,Ring Rd, Kathmandu">Kalanki</option>
                            <option value = "Gwarko Bus Stand,Ring Rd,Kathmandu">Gwarko</option>
                            <option value = "Balkumari Bus Stand,Ring Rd,Kathmandu">Balkumari</option>
                            <option value = "Koteshwore Bus Stand,Ring Rd,Kathmandu">Koteswor</option>
                            <option value = "Tribhuvan International Airport Bus Stop,Ring Rd,">Tribhuvan International Airport</option>
                            <option value = "Gaushala Bus Stop,Ring Rd,Kathmandu">Gaushala</option>
                            <option value = "Chabhil Bus Stop,Ring Rd,Kathmandu">Chabhil</option>
                            <option value = "Sukedhara Bus Stop,Ring Rd,Kathmandu">Sukedhara</option>
                            <option value = "Maharajganj Bus Stop,Ring Rd,Kathmandu">Maharajganj</option>
                            <option value = "Basundhara Bus Stop,Ring Rd,Kathmandu">Basundhara</option>
                            <option value = "Samakhushi Bus Stop,Ring Rd,Kathmandu">Samakhushi</option>
                            <option value = "Gongabu Bus Stop,Ring Rd,Kathmandu">Gongabu</option>
                            <option value = "Balaju Bus Stop,Ring Rd,Kathmandu">Balaju</option>
                            <option value = "Swayambhunath Bus Stop,Ring Rd,Kathmandu">Swayambhunath</option>
                            <option value = "Balkhu bus stop,Ring Rd,Kathmandu">Balkhu</option>
                        </select>
                    </div>
                </div>
            </form> 
           <div class="first-location">
            <b>First Location: </b>
            <p id="latitude"></p>
            <p id="longitude"></p>
           </div>
           
           <div class="second-location">
            <b>Second Location:</b>
            <p id="latitude2"></p>
            <p id="longitude2"></p>
           </div>

            <div class="btnDiv">
              <button class="btn1" onclick="clearStuffs()">Clear</button>
                <button class="btn1" onclick="getLatLong()">Get Lat & Long</button>
                <button class="btn1" type="button" onclick="getRoute()">Calculate</button>
            </div>                    

            </div>
            <div class="container-fluid2">

                <div id="fare"> </div>
                
                <div id="output">
    
                </div>
            </div>
        </div>  
      
        
      <div id="map">
    </div>
  </div>
  <script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyATnxm52zPxVmGGoFfpBeNd8q6aMa9-WAw&callback=initMap&v=weekly" >
    </script>
    <script>

   //Initializing global variables to get value of two selectable form options
let fromValue = document.getElementById("from").value;
let toValue = document.getElementById("to").value;

//Initializing global variables of two selectable form options
const selectFrom = document.getElementById('from');
const selectTo = document.getElementById('to');

//Listening if a value of the selectable form option has changed (if changed, initializes the latest selected value)
selectFrom.addEventListener('change', function handleChange(e) {
    fromValue = document.getElementById("from").value;
});

selectTo.addEventListener('change', function handleChange(e) {
    toValue = document.getElementById("to").value;
});

//Get Longitude and latitude of first place
function getLongitudeLatitude(placeName) {
    const geocoder = new google.maps.Geocoder();
    const latitudeOutput = document.getElementById("latitude");
    const longitudeOutput = document.getElementById("longitude");

    geocoder.geocode({
            address: placeName  //geocoding request to the Google Maps API
        },
        function(results,status) {
            if (status === "OK" && results[0]) {
                const location = results[0].geometry.location;
                const lat = location.lat();
                const lng = location.lng();
                latitudeOutput.textContent = lat;
                longitudeOutput.textContent = lng;
            } else {
                alert("Geocode was not successful for the following reason: " + status);
            }
        }
    );
}

//Get Longitude and latitude of second place

function getLongitudeLatitude2(placeName) {
    const geocoder2 = new google.maps.Geocoder();
    const latitudeOutput2 = document.getElementById("latitude2");
    const longitudeOutput2 = document.getElementById("longitude2");

    geocoder2.geocode({
            address: placeName
        },
        function(results, status) {
            if (status === "OK" && results[0]) {
                const location = results[0].geometry.location;
                const lat2 = location.lat();
                const lng2 = location.lng();
                latitudeOutput2.textContent = lat2;
                longitudeOutput2.textContent = lng2;
            } else {
                alert("Geocode was not successful for the following reason: " + status);
            }
        }
    );

}

function getLatLong() {
    getLongitudeLatitude(fromValue);
    getLongitudeLatitude2(toValue);
}

//Show route function
function getRoute() {
    const empt = document.getElementById('latitude').innerHTML;
    if (empt == null || empt == "") {
        alert("Please get the longitude and latitude first.");
    } else {
        mapRequest(document.getElementById('latitude').textContent, document.getElementById('longitude').textContent, document.getElementById('latitude2').textContent, document.getElementById('longitude2').textContent);
    }
}


// function getDistance(){
//         //DISTANCE********
//     const distance = google.maps.geometry.spherical.computeDistanceBetween(
//         getElementById(fromValue),
//          getLongitudeLatitude2(toValue)
//     )

//     const distanceOutput=document.getElementbyId('distanceOutput');
//     distanceOutput.textContent = `Distance: ${(distance / 1000).toFixed(2)} kilometers`;
//     }

// Calculate distance function
function calculateDistance(lat1, lon1, lat2, lon2) {
    const fromLatLng = new google.maps.LatLng(lat1, lon1);
    const toLatLng = new google.maps.LatLng(lat2, lon2);
    
    // Use the Google Maps geometry library to compute distance
    const distance = google.maps.geometry.spherical.computeDistanceBetween(fromLatLng, toLatLng);

    return distance;
}

function getDistance() {

    // Extract latitude and longitude values from HTML elements
    // const lat1 = parseFloat(document.getElementById('latitude').textContent);
    // const lon1 = parseFloat(document.getElementById('longitude').textContent);
    // const lat2 = parseFloat(document.getElementById('latitude2').textContent);
    // const lon2 = parseFloat(document.getElementById('longitude2').textContent);

    // Check if the latitude and longitude values are valid numbers
    if (!isNaN(lat1) && !isNaN(lon1) && !isNaN(lat2) && !isNaN(lon2)) {
        // Calculate the distance
        const distance = calculateDistance(lat1, lon1, lat2, lon2);

        // Display the distance on your web page
        const distanceOutput = document.getElementById('distanceOutput');
        distanceOutput.textContent = `Distance: ${(distance / 1000).toFixed(2)} kilometers`;
    } else {
        alert('Invalid latitude or longitude values.');
    }
}


    </script>
</body>
</html>